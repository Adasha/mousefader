"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(e,t)})(t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,e,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(a,n.prototype),a}).apply(null,arguments)}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var VALID_DIRECTIONS=new Set(["both","horizontal","vertical"]),DEFAULT_DIRECTION="both",DEFAULT_MODE="redraw",DEFAULT_ACCURACY=5,DEFAULT_FPS=15,DEFAULT_RUNOFF=100,DEFAULT_SCATTER_METHOD="uniform",VALID_EFFECTS={opacity:{min:0,max:1,default:1,rule:"opacity"},translateX:{default:0,rule:"transform",func:"translateX",unit:"px"},translateY:{default:0,rule:"transform",func:"translateY",unit:"px"},translateZ:{default:0,rule:"transform",func:"translateZ",unit:"px"},rotate:{default:0,rule:"transform",func:"rotate",unit:"deg"},rotateX:{default:0,rule:"transform",func:"rotateX",unit:"deg"},rotateY:{default:0,rule:"transform",func:"rotateY",unit:"deg"},rotateZ:{default:0,rule:"transform",func:"rotateZ",unit:"deg"},scale:{default:1,rule:"transform",func:"scale"},scaleX:{default:1,rule:"transform",func:"scaleX"},scaleY:{default:1,rule:"transform",func:"scaleY"},scaleZ:{default:1,rule:"transform",func:"scaleZ"},skewX:{default:0,rule:"transform",func:"skewX",unit:"deg"},skewY:{default:0,rule:"transform",func:"skewY",unit:"deg"},blur:{min:0,default:0,rule:"filter",func:"blur",unit:"px"},brightness:{min:0,default:100,rule:"filter",func:"brightness",unit:"%"},contrast:{min:0,default:100,rule:"filter",func:"contrast",unit:"%"},grayscale:{min:0,max:100,default:0,rule:"filter",func:"grayscale",unit:"%"},hueRotate:{default:0,rule:"filter",func:"hue-rotate",unit:"deg"},invert:{min:0,max:100,default:0,rule:"filter",func:"invert",unit:"%"},saturate:{min:0,max:100,default:100,rule:"filter",func:"saturate",unit:"%"},sepia:{min:0,max:100,default:0,rule:"filter",func:"sepia",unit:"%"},backgroundColor:{min:0,max:255,default:[0,0,0],rule:"backgroundColor",func:"rgb",args:3},scale3D:{default:[1,1,1],rule:"transform",func:"scale3D",args:3}},constrain=function(t,e,n){return"number"!=typeof t?NaN:(null!=e&&"number"==typeof e&&(t=Math.max(t,e)),null!=n&&"number"==typeof n&&(t=Math.min(t,n)),t)},roundTo=function(t,e){var n=1<arguments.length&&void 0!==e?e:0,r=Math.pow(n+1,10);return Math.round(t*r)/r},delta=function(t,e,n){return(n-e)*constrain(t,0,1)+e},map=function(t,e,n,r,a){return(t-e)*(a-r)/(n-e)+r},random=function(t,e){var n=0<arguments.length&&void 0!==t?t:2;switch(1<arguments.length&&void 0!==e?e:"uniform"){case"gaussian":case"normal":for(var r=0,a=0;a<6;a++)r+=(Math.random()-.5)*n;return r/6;case"uniform":default:return(Math.random()-.5)*n}},XOR=function(t,e){return(t||e)&&!(t&&e)},isVisibleInViewport=function(t){var e=t.getBoundingClientRect(),n=document.documentElement;return 0<=e.right&&e.left<=n.clientWidth&&0<=e.bottom&&e.top<=n.clientHeight},valToObj=function(t,e){var n={};return n[1<arguments.length&&void 0!==e?e:"value"]=t,n},isObject=function(t){return t==Object(t)},ProximityEffect=function(){function r(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,r),e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this)),!t)throw new Error("ProximityEffect: nodes argument is required");return e.preventCenterCalculations=!0,e._params=n,e.nodes=t,e._pointer={},e.threshold=e._params.hasOwnProperty("threshold")?e._params.threshold:0,e.runoff=e._params.hasOwnProperty("runoff")?e._params.runoff:DEFAULT_RUNOFF,e.attack=e._params.hasOwnProperty("attack")?e._params.attack:1,e.decay=e._params.hasOwnProperty("decay")?e._params.decay:1,e.accuracy=e._params.hasOwnProperty("accuracy")?e._params.accuracy:DEFAULT_ACCURACY,e.invert=e._params.invert||!1,e.offsetX=e._params.offsetX||0,e.offsetY=e._params.offsetY||0,e.jitter=e._params.jitter||0,e.direction=e._params.direction||DEFAULT_DIRECTION,e.FPS=e._params.FPS||DEFAULT_FPS,e.mode=e._params.mode||DEFAULT_MODE,e.target=e._params.target,"completed"===document.readyState?e.init():window.addEventListener("load",function(){return e.init()}),e}return _inherits(r,_wrapNativeSuper(EventTarget)),_createClass(r,[{key:"init",value:function(){this.preventCenterCalculations=!1,this.setCenterPoints(),this.update=this.update.bind(this),window.addEventListener("scroll",this.reflowEvent.bind(this)),window.addEventListener("resize",this.reflowEvent.bind(this)),document.addEventListener("mousemove",this.updatePointer.bind(this)),document.dispatchEvent(new MouseEvent("mousemove")),this.dispatchEvent(new Event("ready")),window.requestAnimationFrame(this.update)}},{key:"addEffect",value:function(t,e,n,r){if(VALID_EFFECTS.hasOwnProperty(t))r=VALID_EFFECTS[t];else{if(!r||!isObject(r)||"string"!=typeof r.rule)return void console.log("".concat(t," is not a valid effect type"));VALID_EFFECTS[t]=r}"number"==typeof e&&(e=valToObj(constrain(e,r.min,r.max))),"number"==typeof n&&(n=valToObj(constrain(n,r.min,r.max))),this._effects=this._effects||[],this._effects.push({type:t,near:e,far:n,params:r});for(var a=0;a<this._nodeData.length;a++){var o=this.getNodeIndexData(a,"effects")||this._setNodeIndexData(a,"effects",[]).effects,i=e.scatterMethod?e.scatterMethod:DEFAULT_SCATTER_METHOD,s=n.scatterMethod?n.scatterMethod:DEFAULT_SCATTER_METHOD;o.push({near:e.scatter?e.value+random(e.scatter,i):e.value,far:n.scatter?n.value+random(n.scatter,s):n.value})}}},{key:"hasEffect",value:function(e){return void 0!==this.effects.find(function(t){return t.type===e})}},{key:"removeEffect",value:function(t){if(this.hasEffect(t))for(var e=0;e<this.effects.length;e++){this.effects[e].type===t&&this.effects.splice(e,1)}}},{key:"distanceFrom",value:function(t){return this.getNodeData(t,"distance")}},{key:"distanceFromIndex",value:function(t){return this.getNodeIndexData(t,"distance")}},{key:"setCenterPoints",value:function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t],n=e.style.cssText;e.style.cssText=this.getNodeIndexData(t,"style");var r=e.getBoundingClientRect(),a=.5*(r.left+r.right)-this.offsetX,o=.5*(r.top+r.bottom)-this.offsetY,i=this.getNodeIndexData(t,"jitter");i&&0<this.jitter&&(a+=i.x,o+=i.y),e.style.cssText=n,this._setNodeIndexData(t,"center",{x:a,y:o})}}},{key:"getNodeData",value:function(t,e){var n=this._nodeData[this.nodes.findIndex(function(t){return t===node})];return e?n[e]:n}},{key:"getNodeIndexData",value:function(t,e){return this._nodeData[t][e]}},{key:"hasNodeIndexData",value:function(t,e){return this._nodeData[t].hasOwnProperty(e)}},{key:"_setNodeIndexData",value:function(t,e,n){return this._nodeData[t]||(this._nodeData[t]={}),this._nodeData[t][e]=n,this._nodeData[t]}},{key:"updatePointer",value:function(t){this._pointer.x=t.clientX,this._pointer.y=t.clientY}},{key:"reflowEvent",value:function(t){var e=this;t.currentTarget!==this&&this.dispatchEvent(new Event("reflow")),this.preventCenterCalculations||window.setTimeout(function(){return e.setCenterPoints()},1)}},{key:"update",value:function(){document.documentElement;for(var t=0;t<this.nodes.length;t++){var e,n=this.nodes[t],r=(n.getBoundingClientRect(),this.getNodeIndexData(t,"center")),a=r.x-(n.dataset.offsetx||0),o=r.y-(n.dataset.offsety||0),i=void 0,s=void 0,u=this.getNodeIndexData(t,"lastDelta");s=this.target?(i=.5*((e=this.target.getBoundingClientRect()).left+e.right),.5*(e.top+e.bottom)):(i=this.pointer.x,this.pointer.y);var c,f=i-a,l=s-o,d=void 0,h=void 0,d="both"===this.direction?Math.sqrt(f*f+l*l):Math.abs("horizontal"===this.direction?f:l),h=constrain((d-this.threshold)*this._invRunoff,0,1);if(this.invert&&(h=1-h),this._setNodeIndexData(t,"distance",h),c=u+(h-u)*(XOR(u<h,this.invert)?this.decay:this.attack),c=roundTo(c,this.accuracy),this._setNodeIndexData(t,"lastDelta",c),0<this.effects.length){for(var p={},m=0;m<this._effects.length;m++){var _=this._effects[m],y=this.getNodeIndexData(t,"effects")[m],v=y.near,g=y.far,E=_.params.rule,b=_.params.func,w=_.params.unit||"",D=delta(c,v,g);b?(p[E]||(p[E]=[]),p[E].push(b+"("+D+w+")")):n.style[E]="".concat(D).concat(w)}for(var C in p)n.style[C]=p[C].join(" ");var k=Math.floor(1e3*c);n.style.zIndex=this.invert?k:1e3-k}}"redraw"===this.mode&&window.requestAnimationFrame(this.update),this.dispatchEvent(new Event("redraw"))}},{key:"target",get:function(){return this._params.target},set:function(t){!t||t.getBoundingClientRect()?this._params.target=t:console.log("".concat(t," is not a valid target"))}},{key:"nodes",get:function(){return this._nodes},set:function(t){var e=this;if(!(t instanceof NodeList))throw new Error("".concat(t," is not a node list"));if(t.length<1)throw new Error("No nodes found in ".concat(t));this._nodes=[].slice.call(t),this._nodeData=this._nodes.map(function(t){return{node:t,style:t.style.cssText,lastDelta:e._params.doPresetDistances?1:null}}),this._params&&!this.preventCenterCalculations&&this.setCenterPoints()}},{key:"effects",get:function(){return this._effects}},{key:"threshold",get:function(){return this._params.threshold},set:function(t){this._params.threshold=constrain(t,0)}},{key:"runoff",get:function(){return this._params.runoff},set:function(t){this._params.runoff=constrain(t,0),this._invRunoff=1/this._params.runoff}},{key:"boundary",get:function(){return this.threshold+this.runoff}},{key:"invert",get:function(){return this._params.invert},set:function(t){this._params.invert=!!t}},{key:"attack",get:function(){return this._params.attack},set:function(t){this._params.attack=constrain(t,0,1)}},{key:"decay",get:function(){return this._params.decay},set:function(t){this._params.decay=constrain(t,0,1)}},{key:"offsetX",get:function(){return this._params.offsetX},set:function(t){this._params.offsetX=t,this.preventCenterCalculations||this.setCenterPoints()}},{key:"offsetY",get:function(){return this._params.offsetY},set:function(t){this._params.offsetY=t,this.preventCenterCalculations||this.setCenterPoints()}},{key:"jitter",get:function(){return this._params.jitter},set:function(t){this._params.jitter=constrain(t,0);for(var e=0;e<this.nodes.length;e++)this._setNodeIndexData(e,"jitter",{x:random(this.jitter),y:random(this.jitter)});this.preventCenterCalculations||this.setCenterPoints()}},{key:"direction",get:function(){return this._params.direction},set:function(t){VALID_DIRECTIONS.has(t)?this._params.direction=t:console.log("".concat(t," not a valid direction."))}},{key:"FPS",get:function(){return this._params.FPS},set:function(t){0<t?this._params.FPS=constrain(t,0):console.log("Invalid FPS requested.")}},{key:"mode",get:function(){return this._params.mode},set:function(t){if(t){if(t===this._params.mode)return void console.log("Already in ".concat(t," mode. Mode not changed."));var e=document.body;switch(t){case"mousemove":e.addEventListener("mousemove",this.update());break;case"enterframe":e.addEventListener("enterframe",this.update()),this._frameLoop=window.setInterval(function(){return e.dispatchEvent(new Event("enterframe"))},1e3/this.FPS);break;case"redraw":break;default:return void console.log("".concat(t," is not a recognised mode."))}this._params.mode=t}}},{key:"accuracy",get:function(){return this._params.accuracy},set:function(t){this._params.accuracy=Math.floor(constrain(t,0))}},{key:"pointer",get:function(){return{x:this._pointer.x,y:this._pointer.y}}}]),r}();