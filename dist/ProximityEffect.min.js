"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _createSuper(a){var i=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(a);return _possibleConstructorReturn(this,i?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var a="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,e)}function e(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(e,t)})(t)}function _construct(t,e,a){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(t,e,a){var i=[null];i.push.apply(i,e);var s=new(Function.bind.apply(t,i));return a&&_setPrototypeOf(s,a.prototype),s}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classPrivateMethodGet(t,e,a){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return a}function _classPrivateFieldGet(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function _classPrivateFieldSet(t,e,a){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}return a}var constrain=function(t,e,a){return"number"!=typeof t?NaN:(null!=e&&"number"==typeof e&&(t=Math.max(t,e)),null!=a&&"number"==typeof a&&(t=Math.min(t,a)),t)},roundTo=function(t,e){var a=1<arguments.length&&void 0!==e?e:0,i=Math.pow(a+1,10);return Math.round(t*i)/i},delta=function(t,e,a){return(a-e)*constrain(t,0,1)+e},map=function(t,e,a,i,s){return(t-e)*(s-i)/(a-e)+i},random=function(t,e){var a=0<arguments.length&&void 0!==t?t:2;switch(1<arguments.length&&void 0!==e?e:"uniform"){case"gaussian":case"normal":for(var i=0,s=0;s<6;s++)i+=(Math.random()-.5)*a;return i/6;case"uniform":default:return(Math.random()-.5)*a}},XOR=function(t,e){return(t||e)&&!(t&&e)},isVisibleInViewport=function(t){var e=t.getBoundingClientRect(),a=document.documentElement;return 0<=e.right&&e.left<=a.clientWidth&&0<=e.bottom&&e.top<=a.clientHeight},valToObj=function(t,e){var a={};return a[1<arguments.length&&void 0!==e?e:"value"]=t,a},isObject=function(t){return t==Object(t)},_params=new WeakMap,_pointer=new WeakMap,_effects=new WeakMap,_nodes=new WeakMap,_nodeData=new WeakMap,_VALID_DIRECTIONS=new WeakMap,_DEFAULT_DIRECTION=new WeakMap,_DEFAULT_MODE=new WeakMap,_DEFAULT_ACCURACY=new WeakMap,_DEFAULT_FPS=new WeakMap,_DEFAULT_RUNOFF=new WeakMap,_DEFAULT_SCATTER_METHOD=new WeakMap,_VALID_EFFECTS=new WeakMap,_init=new WeakSet,_setNodeIndexData=new WeakSet,ProximityEffect=function(){_inherits(s,_wrapNativeSuper(EventTarget));var i=_createSuper(s);function s(t){var e,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,s),e=i.call(this),_setNodeIndexData.add(_assertThisInitialized(e)),_init.add(_assertThisInitialized(e)),_params.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_pointer.set(_assertThisInitialized(e),{writable:!0,value:{}}),_effects.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_nodes.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_nodeData.set(_assertThisInitialized(e),{writable:!0,value:void 0}),_VALID_DIRECTIONS.set(_assertThisInitialized(e),{writable:!0,value:new Set(["both","horizontal","vertical"])}),_DEFAULT_DIRECTION.set(_assertThisInitialized(e),{writable:!0,value:"both"}),_DEFAULT_MODE.set(_assertThisInitialized(e),{writable:!0,value:"redraw"}),_DEFAULT_ACCURACY.set(_assertThisInitialized(e),{writable:!0,value:5}),_DEFAULT_FPS.set(_assertThisInitialized(e),{writable:!0,value:15}),_DEFAULT_RUNOFF.set(_assertThisInitialized(e),{writable:!0,value:100}),_DEFAULT_SCATTER_METHOD.set(_assertThisInitialized(e),{writable:!0,value:"uniform"}),_VALID_EFFECTS.set(_assertThisInitialized(e),{writable:!0,value:{opacity:{min:0,max:1,default:1,rule:"opacity"},translateX:{default:0,rule:"transform",func:"translateX",unit:"px"},translateY:{default:0,rule:"transform",func:"translateY",unit:"px"},translateZ:{default:0,rule:"transform",func:"translateZ",unit:"px"},rotate:{default:0,rule:"transform",func:"rotate",unit:"deg"},rotateX:{default:0,rule:"transform",func:"rotateX",unit:"deg"},rotateY:{default:0,rule:"transform",func:"rotateY",unit:"deg"},rotateZ:{default:0,rule:"transform",func:"rotateZ",unit:"deg"},scale:{default:1,rule:"transform",func:"scale"},scaleX:{default:1,rule:"transform",func:"scaleX"},scaleY:{default:1,rule:"transform",func:"scaleY"},scaleZ:{default:1,rule:"transform",func:"scaleZ"},skewX:{default:0,rule:"transform",func:"skewX",unit:"deg"},skewY:{default:0,rule:"transform",func:"skewY",unit:"deg"},blur:{min:0,default:0,rule:"filter",func:"blur",unit:"px"},brightness:{min:0,default:100,rule:"filter",func:"brightness",unit:"%"},contrast:{min:0,default:100,rule:"filter",func:"contrast",unit:"%"},grayscale:{min:0,max:100,default:0,rule:"filter",func:"grayscale",unit:"%"},hueRotate:{default:0,rule:"filter",func:"hue-rotate",unit:"deg"},invert:{min:0,max:100,default:0,rule:"filter",func:"invert",unit:"%"},saturate:{min:0,max:100,default:100,rule:"filter",func:"saturate",unit:"%"},sepia:{min:0,max:100,default:0,rule:"filter",func:"sepia",unit:"%"},backgroundColor:{min:0,max:255,default:[0,0,0],rule:"backgroundColor",func:"rgb",args:3},scale3D:{default:[1,1,1],rule:"transform",func:"scale3D",args:3}}}),!t)throw new Error("ProximityEffect: nodes argument is required");return e.preventCenterCalculations=!0,_classPrivateFieldSet(_assertThisInitialized(e),_params,a),e.nodes=t,e.threshold=_classPrivateFieldGet(_assertThisInitialized(e),_params).hasOwnProperty("threshold")?_classPrivateFieldGet(_assertThisInitialized(e),_params).threshold:0,e.runoff=_classPrivateFieldGet(_assertThisInitialized(e),_params).hasOwnProperty("runoff")?_classPrivateFieldGet(_assertThisInitialized(e),_params).runoff:_classPrivateFieldGet(_assertThisInitialized(e),_DEFAULT_RUNOFF),e.attack=_classPrivateFieldGet(_assertThisInitialized(e),_params).hasOwnProperty("attack")?_classPrivateFieldGet(_assertThisInitialized(e),_params).attack:1,e.decay=_classPrivateFieldGet(_assertThisInitialized(e),_params).hasOwnProperty("decay")?_classPrivateFieldGet(_assertThisInitialized(e),_params).decay:1,e.accuracy=_classPrivateFieldGet(_assertThisInitialized(e),_params).hasOwnProperty("accuracy")?_classPrivateFieldGet(_assertThisInitialized(e),_params).accuracy:_classPrivateFieldGet(_assertThisInitialized(e),_DEFAULT_ACCURACY),e.invert=_classPrivateFieldGet(_assertThisInitialized(e),_params).invert||!1,e.offsetX=_classPrivateFieldGet(_assertThisInitialized(e),_params).offsetX||0,e.offsetY=_classPrivateFieldGet(_assertThisInitialized(e),_params).offsetY||0,e.jitter=_classPrivateFieldGet(_assertThisInitialized(e),_params).jitter||0,e.direction=_classPrivateFieldGet(_assertThisInitialized(e),_params).direction||_classPrivateFieldGet(_assertThisInitialized(e),_DEFAULT_DIRECTION),e.FPS=_classPrivateFieldGet(_assertThisInitialized(e),_params).FPS||_classPrivateFieldGet(_assertThisInitialized(e),_DEFAULT_FPS),e.mode=_classPrivateFieldGet(_assertThisInitialized(e),_params).mode||_classPrivateFieldGet(_assertThisInitialized(e),_DEFAULT_MODE),e.target=_classPrivateFieldGet(_assertThisInitialized(e),_params).target,"completed"===document.readyState?_classPrivateMethodGet(_assertThisInitialized(e),_init,_init2).call(_assertThisInitialized(e)):window.addEventListener("load",function(){return _classPrivateMethodGet(_assertThisInitialized(e),_init,_init2).call(_assertThisInitialized(e))}),e}return _createClass(s,[{key:"addEffect",value:function(t,e,a,i){if(_classPrivateFieldGet(this,_VALID_EFFECTS).hasOwnProperty(t))i=_classPrivateFieldGet(this,_VALID_EFFECTS)[t];else{if(!i||!isObject(i)||"string"!=typeof i.rule)return void console.log("".concat(t," is not a valid effect type"));_classPrivateFieldGet(this,_VALID_EFFECTS)[t]=i}"number"==typeof e&&(e=valToObj(constrain(e,i.min,i.max))),"number"==typeof a&&(a=valToObj(constrain(a,i.min,i.max))),_classPrivateFieldSet(this,_effects,_classPrivateFieldGet(this,_effects)||[]),_classPrivateFieldGet(this,_effects).push({type:t,near:e,far:a,params:i});for(var s=0;s<_classPrivateFieldGet(this,_nodeData).length;s++){var r=this.getNodeIndexData(s,"effects")||_classPrivateMethodGet(this,_setNodeIndexData,_setNodeIndexData2).call(this,s,"effects",[]).effects,n=e.scatterMethod?e.scatterMethod:_classPrivateFieldGet(this,_DEFAULT_SCATTER_METHOD),o=a.scatterMethod?a.scatterMethod:_classPrivateFieldGet(this,_DEFAULT_SCATTER_METHOD);r.push({near:e.scatter?e.value+random(e.scatter,n):e.value,far:a.scatter?a.value+random(a.scatter,o):a.value})}}},{key:"hasEffect",value:function(e){return void 0!==this.effects.find(function(t){return t.type===e})}},{key:"removeEffect",value:function(t){if(this.hasEffect(t))for(var e=0;e<_classPrivateFieldGet(this,_effects).length;e++){_classPrivateFieldGet(this,_effects)[e].type===t&&_classPrivateFieldGet(this,_effects).splice(e,1)}}},{key:"distanceFrom",value:function(t){return this.getNodeData(t,"distance")}},{key:"distanceFromIndex",value:function(t){return this.getNodeIndexData(t,"distance")}},{key:"setCenterPoints",value:function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t],a=e.style.cssText;e.style.cssText=this.getNodeIndexData(t,"style");var i=e.getBoundingClientRect(),s=.5*(i.left+i.right)-this.offsetX,r=.5*(i.top+i.bottom)-this.offsetY,n=this.getNodeIndexData(t,"jitter");n&&0<this.jitter&&(s+=n.x,r+=n.y),e.style.cssText=a,_classPrivateMethodGet(this,_setNodeIndexData,_setNodeIndexData2).call(this,t,"center",{x:s,y:r})}}},{key:"getNodeData",value:function(t,e){var a=_classPrivateFieldGet(this,_nodeData)[this.nodes.findIndex(function(t){return t===node})];return e?a[e]:a}},{key:"getNodeIndexData",value:function(t,e){return _classPrivateFieldGet(this,_nodeData)[t][e]}},{key:"hasNodeIndexData",value:function(t,e){return _classPrivateFieldGet(this,_nodeData)[t].hasOwnProperty(e)}},{key:"updatePointer",value:function(t){_classPrivateFieldGet(this,_pointer).x=t.clientX,_classPrivateFieldGet(this,_pointer).y=t.clientY}},{key:"reflowEvent",value:function(t){var e=this;t.currentTarget!==this&&this.dispatchEvent(new Event("reflow")),this.preventCenterCalculations||window.setTimeout(function(){return e.setCenterPoints()},1)}},{key:"update",value:function(){document.documentElement;for(var t=0;t<this.nodes.length;t++){var e,a=this.nodes[t],i=(a.getBoundingClientRect(),this.getNodeIndexData(t,"center")),s=i.x-(a.dataset.offsetx||0),r=i.y-(a.dataset.offsety||0),n=void 0,o=void 0,l=this.getNodeIndexData(t,"lastDelta");o=this.target?(n=.5*((e=this.target.getBoundingClientRect()).left+e.right),.5*(e.top+e.bottom)):(n=this.pointer.x,this.pointer.y);var c,u=n-s,d=o-r,f=void 0,_=void 0,f="both"===this.direction?Math.sqrt(u*u+d*d):Math.abs("horizontal"===this.direction?u:d),_=constrain((f-this.threshold)*_classPrivateFieldGet(this,_params).invRunoff,0,1);if(this.invert&&(_=1-_),_classPrivateMethodGet(this,_setNodeIndexData,_setNodeIndexData2).call(this,t,"distance",_),c=l+(_-l)*(XOR(l<_,this.invert)?this.decay:this.attack),c=roundTo(c,this.accuracy),_classPrivateMethodGet(this,_setNodeIndexData,_setNodeIndexData2).call(this,t,"lastDelta",c),0<this.effects.length){for(var h={},v=0;v<this.effects.length;v++){var p=this.effects[v],m=this.getNodeIndexData(t,"effects")[v],y=m.near,P=m.far,F=p.params.rule,g=p.params.func,T=p.params.unit||"",w=delta(c,y,P);g?(h[F]||(h[F]=[]),h[F].push(g+"("+w+T+")")):a.style[F]="".concat(w).concat(T)}for(var I in h)a.style[I]=h[I].join(" ");var G=Math.floor(1e3*c);a.style.zIndex=this.invert?G:1e3-G}}"redraw"===this.mode&&window.requestAnimationFrame(this.update),this.dispatchEvent(new Event("redraw"))}},{key:"target",get:function(){return _classPrivateFieldGet(this,_params).target},set:function(t){!t||t.getBoundingClientRect()?_classPrivateFieldGet(this,_params).target=t:console.log("".concat(t," is not a valid target"))}},{key:"nodes",get:function(){return _classPrivateFieldGet(this,_nodes)},set:function(t){var e=this;if(!(t instanceof NodeList))throw new Error("".concat(t," is not a node list"));if(t.length<1)throw new Error("No nodes found in ".concat(t));_classPrivateFieldSet(this,_nodes,[].slice.call(t)),_classPrivateFieldSet(this,_nodeData,_classPrivateFieldGet(this,_nodes).map(function(t){return{node:t,style:t.style.cssText,lastDelta:_classPrivateFieldGet(e,_params).doPresetDistances?1:null}})),_classPrivateFieldGet(this,_params)&&!this.preventCenterCalculations&&this.setCenterPoints()}},{key:"effects",get:function(){return _classPrivateFieldGet(this,_effects)}},{key:"threshold",get:function(){return _classPrivateFieldGet(this,_params).threshold},set:function(t){_classPrivateFieldGet(this,_params).threshold=constrain(t,0)}},{key:"runoff",get:function(){return _classPrivateFieldGet(this,_params).runoff},set:function(t){_classPrivateFieldGet(this,_params).runoff=constrain(t,0),_classPrivateFieldGet(this,_params).invRunoff=1/_classPrivateFieldGet(this,_params).runoff}},{key:"boundary",get:function(){return this.threshold+this.runoff}},{key:"invert",get:function(){return _classPrivateFieldGet(this,_params).invert},set:function(t){_classPrivateFieldGet(this,_params).invert=!!t}},{key:"attack",get:function(){return _classPrivateFieldGet(this,_params).attack},set:function(t){_classPrivateFieldGet(this,_params).attack=constrain(t,0,1)}},{key:"decay",get:function(){return _classPrivateFieldGet(this,_params).decay},set:function(t){_classPrivateFieldGet(this,_params).decay=constrain(t,0,1)}},{key:"offsetX",get:function(){return _classPrivateFieldGet(this,_params).offsetX},set:function(t){_classPrivateFieldGet(this,_params).offsetX=t,this.preventCenterCalculations||this.setCenterPoints()}},{key:"offsetY",get:function(){return _classPrivateFieldGet(this,_params).offsetY},set:function(t){_classPrivateFieldGet(this,_params).offsetY=t,this.preventCenterCalculations||this.setCenterPoints()}},{key:"jitter",get:function(){return _classPrivateFieldGet(this,_params).jitter},set:function(t){_classPrivateFieldGet(this,_params).jitter=constrain(t,0);for(var e=0;e<this.nodes.length;e++)_classPrivateMethodGet(this,_setNodeIndexData,_setNodeIndexData2).call(this,e,"jitter",{x:random(this.jitter),y:random(this.jitter)});this.preventCenterCalculations||this.setCenterPoints()}},{key:"direction",get:function(){return _classPrivateFieldGet(this,_params).direction},set:function(t){_classPrivateFieldGet(this,_VALID_DIRECTIONS).has(t)?_classPrivateFieldGet(this,_params).direction=t:console.log("".concat(t," not a valid direction."))}},{key:"FPS",get:function(){return _classPrivateFieldGet(this,_params).FPS},set:function(t){0<t?_classPrivateFieldGet(this,_params).FPS=constrain(t,0):console.log("Invalid FPS requested.")}},{key:"mode",get:function(){return _classPrivateFieldGet(this,_params).mode},set:function(t){if(t){if(t===_classPrivateFieldGet(this,_params).mode)return void console.log("Already in ".concat(t," mode. Mode not changed."));var e=document.body;switch(t){case"mousemove":e.addEventListener("mousemove",this.update());break;case"enterframe":e.addEventListener("enterframe",this.update()),this._frameLoop=window.setInterval(function(){return e.dispatchEvent(new Event("enterframe"))},1e3/this.FPS);break;case"redraw":break;default:return void console.log("".concat(t," is not a recognised mode."))}_classPrivateFieldGet(this,_params).mode=t}}},{key:"accuracy",get:function(){return _classPrivateFieldGet(this,_params).accuracy},set:function(t){_classPrivateFieldGet(this,_params).accuracy=Math.floor(constrain(t,0))}},{key:"pointer",get:function(){return{x:_classPrivateFieldGet(this,_pointer).x,y:_classPrivateFieldGet(this,_pointer).y}}}]),s}(),_init2=function(){this.preventCenterCalculations=!1,this.setCenterPoints(),this.update=this.update.bind(this),window.addEventListener("scroll",this.reflowEvent.bind(this)),window.addEventListener("resize",this.reflowEvent.bind(this)),document.addEventListener("mousemove",this.updatePointer.bind(this)),document.dispatchEvent(new MouseEvent("mousemove")),this.dispatchEvent(new Event("ready")),window.requestAnimationFrame(this.update)},_setNodeIndexData2=function(t,e,a){return _classPrivateFieldGet(this,_nodeData)[t]||(_classPrivateFieldGet(this,_nodeData)[t]={}),_classPrivateFieldGet(this,_nodeData)[t][e]=a,_classPrivateFieldGet(this,_nodeData)[t]};