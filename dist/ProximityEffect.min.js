"use strict";var _createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _extendableBuiltin(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var VALID_MODES=new Set(["mousemove","enterframe","redraw"]),VALID_DIRECTIONS=new Set(["both","horizontal","vertical"]),DEFAULT_DIRECTION="both",DEFAULT_MODE="redraw",DEFAULT_ACCURACY=5,DEFAULT_FPS=15,DEFAULT_RUNOFF=100,VALID_EFFECTS={opacity:{min:0,max:1,default:1,rule:"opacity"},translateX:{default:0,rule:"transform",func:"translateX",unit:"px"},translateY:{default:0,rule:"transform",func:"translateY",unit:"px"},translateZ:{default:0,rule:"transform",func:"translateZ",unit:"px"},rotate:{default:0,rule:"transform",func:"rotate",unit:"deg"},rotateX:{default:0,rule:"transform",func:"rotateX",unit:"deg"},rotateY:{default:0,rule:"transform",func:"rotateY",unit:"deg"},rotateZ:{default:0,rule:"transform",func:"rotateZ",unit:"deg"},scale:{default:1,rule:"transform",func:"scale"},scaleX:{default:1,rule:"transform",func:"scaleX"},scaleY:{default:1,rule:"transform",func:"scaleY"},scaleZ:{default:1,rule:"transform",func:"scaleZ"},skewX:{default:0,rule:"transform",func:"skewX",unit:"deg"},skewY:{default:0,rule:"transform",func:"skewY",unit:"deg"},blur:{min:0,default:0,rule:"filter",func:"blur",unit:"px"},brightness:{min:0,default:100,rule:"filter",func:"brightness",unit:"%"},contrast:{min:0,default:100,rule:"filter",func:"contrast",unit:"%"},grayscale:{min:0,max:100,default:0,rule:"filter",func:"grayscale",unit:"%"},hueRotate:{default:0,rule:"filter",func:"hue-rotate",unit:"deg"},invert:{min:0,max:100,default:0,rule:"filter",func:"invert",unit:"%"},saturate:{min:0,max:100,default:100,rule:"filter",func:"saturate",unit:"%"},sepia:{min:0,max:100,default:0,rule:"filter",func:"sepia",unit:"%"},backgroundColor:{min:0,max:255,default:[0,0,0],rule:"backgroundColor",func:"rgb",args:3},scale3D:{default:[1,1,1],rule:"transform",func:"scale3D",args:3}},constrain=function(t,e,n){return"number"!=typeof t?NaN:(null!=e&&"number"==typeof e&&(t=Math.max(t,e)),null!=n&&"number"==typeof n&&(t=Math.min(t,n)),t)},roundTo=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=Math.pow(e+1,10);return Math.round(t*n)/n},delta=function(t,e,n){return(n-e)*constrain(t,0,1)+e},map=function(t,e,n,r,a){return(t-e)*(a-r)/(n-e)+r},XOR=function(t,e){return(t||e)&&!(t&&e)},isVisibleInViewport=function(t){var e=t.getBoundingClientRect(),n=document.documentElement;return 0<=e.right&&e.left<=n.clientWidth&&0<=e.bottom&&e.top<=n.clientHeight},valToObj=function(t){var e={};return e[1<arguments.length&&void 0!==arguments[1]?arguments[1]:"value"]=t,e},isObject=function(t){return t==Object(t)},ProximityEffect=function(t){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t?(n.preventCenterCalculations=!0,n.nodes=t,n._params=e,n._pointer={},n.threshold=n._params.hasOwnProperty("threshold")?n._params.threshold:0,n.runoff=n._params.hasOwnProperty("runoff")?n._params.runoff:DEFAULT_RUNOFF,n.attack=n._params.hasOwnProperty("attack")?n._params.attack:1,n.decay=n._params.hasOwnProperty("decay")?n._params.decay:1,n.accuracy=n._params.hasOwnProperty("accuracy")?n._params.accuracy:DEFAULT_ACCURACY,n.invert=n._params.invert||!1,n.offsetX=n._params.offsetX||0,n.offsetY=n._params.offsetY||0,n.jitter=n._params.jitter||0,n.direction=n._params.direction||DEFAULT_DIRECTION,n.FPS=n._params.FPS||DEFAULT_FPS,n.mode=n._params.mode||DEFAULT_MODE,n.preventCenterCalculations=!1,n.setCenterPoints(),n.update=n.update.bind(n),window.addEventListener("scroll",n.windowEvent.bind(n)),window.addEventListener("resize",n.windowEvent.bind(n)),document.addEventListener("mousemove",n.updatePointer.bind(n)),document.dispatchEvent(new MouseEvent("mousemove")),window.requestAnimationFrame(n.update),n):(console.log("ProximityEffect: nodes argument is required"),_possibleConstructorReturn(n,null))}return _inherits(r,_extendableBuiltin(EventTarget)),_createClass(r,[{key:"addEffect",value:function(t,e,n,r){if(VALID_EFFECTS.hasOwnProperty(t))r=VALID_EFFECTS[t];else{if(!r||!isObject(r)||"string"!=typeof r.name||"string"!=typeof r.rule)return void console.log(t+" is not a valid effect type");VALID_EFFECTS[t]=r}"number"==typeof e&&(e=valToObj(constrain(e,r.min,r.max))),"number"==typeof n&&(n=valToObj(constrain(n,r.min,r.max))),this._effects=this._effects||[],this._effects.push({type:t,near:e,far:n,params:r});for(var a=0;a<this._nodeData.length;a++){(this._getNodeData(a,"effects")||this._setNodeData(a,"effects",[]).effects).push({near:e.scatter?e.value+(Math.random()-.5)*e.scatter:e.value,far:n.scatter?n.value+(Math.random()-.5)*n.scatter:n.value})}}},{key:"hasEffect",value:function(e){return void 0!==this._effects.find(function(t){return t.type===e})}},{key:"removeEffect",value:function(t){if(this.hasEffect(t))for(var e=0;e<this._effects.length;e++){this._effects[e].type===t&&this._effects.splice(e,1)}}},{key:"distanceFrom",value:function(e){return this._getNodeData(this.nodes.findIndex(function(t){return t===e}),"distance")}},{key:"distanceFromIndex",value:function(t){return this._getNodeData(t,"distance")}},{key:"setCenterPoints",value:function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t].getBoundingClientRect(),n=.5*(e.left+e.right)-this.offsetX,r=.5*(e.top+e.bottom)-this.offsetY,a=this._getNodeData(t,"jitter");0<this.jitter&&a&&(n+=a.x,r+=a.y),this._setNodeData(t,"center",{x:n,y:r})}}},{key:"_getNodeData",value:function(t,e){return this._nodeData[t][e]}},{key:"_setNodeData",value:function(t,e,n){return this._nodeData[t]||(this._nodeData[t]={}),this._nodeData[t][e]=n,this._nodeData[t]}},{key:"updatePointer",value:function(t){this._pointer.x=t.clientX,this._pointer.y=t.clientY}},{key:"windowEvent",value:function(t){var e=this;this.preventCenterCalculations||window.setTimeout(function(){return e.setCenterPoints()},1)}},{key:"update",value:function(t){document.documentElement;for(var e=0;e<this.nodes.length;e++){var n=this.nodes[e],r=this._getNodeData(e,"lastDelta"),a=(n.getBoundingClientRect(),this._getNodeData(e,"center")),o=a.x-(n.dataset.offsetx||0),i=a.y-(n.dataset.offsety||0),s=void 0,u=void 0;if(this.target){var f=this.target.getBoundingClientRect();s=.5*(f.left+f.right),u=.5*(f.top+f.bottom)}else s=this.pointer.x,u=this.pointer.y;var c=s-o,l=u-i,d=void 0,h=void 0,p=void 0;if(d="both"===this.direction?Math.sqrt(c*c+l*l):Math.abs("horizontal"===this.direction?c:l),h=constrain((d-this.threshold)*this._invRunoff,0,1),this.invert&&(h=1-h),this._setNodeData(e,"distance",h),p=r?r+(h-r)*(XOR(r<h,this.invert)?this.decay:this.attack):h,p=roundTo(p,this.accuracy),this._setNodeData(e,"lastDelta",p),p<=1&&this._effects){for(var m={},_=0;_<this._effects.length;_++){var y=this._effects[_],v=this._getNodeData(e,"effects")[_],g=(y.type,v.near),b=v.far,C=y.params.rule,D=y.params.func,E=y.params.unit||"",w=delta(p,g,b);D?(m[C]||(m[C]=[]),m[C].push(D+"("+w+E+")")):n.style[C]=""+w+E}for(var k in m)n.style[k]=m[k].join(" ");var O=Math.floor(1e3*p);n.style.zIndex=this.invert?O:1e3-O}}"redraw"===this.mode&&window.requestAnimationFrame(this.update),this.dispatchEvent(new Event("redraw"))}},{key:"target",get:function(){return this._target},set:function(t){!t||t.getBoundingClientRect()?this._target=t:console.log(t+" is not a valid target")}},{key:"nodes",get:function(){return this._nodes},set:function(t){var e=void 0;t instanceof NodeList?(console.log("NodeList with "+t.length+" childNodes found"),(e=t).length<1?console.log("No nodes found in "+t):(this._nodes=[].slice.call(e),this._nodeData=this._nodes.map(function(t){}),this._params&&!this.preventCenterCalculations&&this.setCenterPoints())):console.log(t+" is not a node list")}},{key:"threshold",get:function(){return this._params.threshold},set:function(t){this._params.threshold=constrain(t,0)}},{key:"runoff",get:function(){return this._params.runoff},set:function(t){this._params.runoff=constrain(t,0),this._invRunoff=1/this._params.runoff}},{key:"boundary",get:function(){return this.threshold+this.runoff}},{key:"invert",get:function(){return this._params.invert},set:function(t){this._params.invert=!!t}},{key:"attack",get:function(){return this._params.attack},set:function(t){this._params.attack=constrain(t,0,1)}},{key:"decay",get:function(){return this._params.decay},set:function(t){this._params.decay=constrain(t,0,1)}},{key:"offsetX",get:function(){return this._params.offsetX},set:function(t){this._params.offsetX=t,this.preventCenterCalculations||this.setCenterPoints()}},{key:"offsetY",get:function(){return this._params.offsetY},set:function(t){this._params.offsetY=t,this.preventCenterCalculations||this.setCenterPoints()}},{key:"jitter",get:function(){return this._params.jitter},set:function(t){this._params.jitter=constrain(t,0);for(var e=0;e<this.nodes.length;e++)this._setNodeData(e,"jitter",{x:(Math.random()-.5)*this.jitter,y:(Math.random()-.5)*this.jitter});this.preventCenterCalculations||this.setCenterPoints()}},{key:"direction",get:function(){return this._params.direction},set:function(t){VALID_DIRECTIONS.has(t)?this._params.direction=t:console.log(t+" not a valid direction.")}},{key:"FPS",get:function(){return this._params.FPS},set:function(t){0<t?this._params.FPS=constrain(t,0):console.log("Invalid FPS requested")}},{key:"mode",get:function(){return this._params.mode},set:function(t){t!==this._params.mode?VALID_MODES.has(t)?this._params.mode=t:console.log(t+" not a recognised mode."):console.log("Already in "+t+" mode. Mode not changed.")}},{key:"accuracy",get:function(){return this._params.accuracy},set:function(t){this._params.accuracy=Math.floor(constrain(t,0))}},{key:"pointer",get:function(){return{x:this._pointer.x,y:this._pointer.y}}}]),r}();