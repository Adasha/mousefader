"use strict";var _VALID_EFFECTS,_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _extendableBuiltin(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var VALID_MODES=new Set(["mousemove","enterframe","redraw"]),VALID_DIRECTIONS=new Set(["both","horizontal","vertical"]),DEFAULT_DIRECTION="both",DEFAULT_MODE="redraw",DEFAULT_ACCURACY=5,DEFAULT_FPS=15,DEFAULT_RUNOFF=100,VALID_EFFECTS=(_defineProperty(_VALID_EFFECTS={opacity:{min:0,max:1,default:1,rule:"opacity"},translateX:{default:0,rule:"transform",func:"translateX",unit:"px"},translateY:{default:0,rule:"transform",func:"translateY",unit:"px"},translateZ:{default:0,rule:"transform",func:"translateZ",unit:"px"},rotate:{default:0,rule:"transform",func:"rotate",unit:"deg"},rotateX:{default:0,rule:"transform",func:"rotateX",unit:"deg"},rotateY:{default:0,rule:"transform",func:"rotateY",unit:"deg"},rotateZ:{default:0,rule:"transform",func:"rotateZ",unit:"deg"},scale:{default:1,rule:"transform",func:"scale"},scaleX:{default:1,rule:"transform",func:"scaleX"},scaleY:{default:1,rule:"transform",func:"scaleY"}},"scaleY",{default:1,rule:"transform",func:"scaleY"}),_defineProperty(_VALID_EFFECTS,"skewX",{default:0,rule:"transform",func:"skewX",unit:"deg"}),_defineProperty(_VALID_EFFECTS,"skewY",{default:0,rule:"transform",func:"skewY",unit:"deg"}),_defineProperty(_VALID_EFFECTS,"perspective",{default:0,rule:"transform",func:"perspective",unit:"px"}),_defineProperty(_VALID_EFFECTS,"blur",{min:0,default:0,rule:"filter",func:"blur",unit:"px"}),_defineProperty(_VALID_EFFECTS,"brightness",{min:0,default:100,rule:"filter",func:"brightness",unit:"%"}),_defineProperty(_VALID_EFFECTS,"contrast",{min:0,default:100,rule:"filter",func:"contrast",unit:"%"}),_defineProperty(_VALID_EFFECTS,"grayscale",{min:0,max:100,default:0,rule:"filter",func:"grayscale",unit:"%"}),_defineProperty(_VALID_EFFECTS,"hueRotate",{default:0,rule:"filter",func:"hue-rotate",unit:"deg"}),_defineProperty(_VALID_EFFECTS,"invert",{min:0,max:100,default:0,rule:"filter",func:"invert",unit:"%"}),_defineProperty(_VALID_EFFECTS,"saturate",{min:0,max:100,default:100,rule:"filter",func:"saturate",unit:"%"}),_defineProperty(_VALID_EFFECTS,"sepia",{min:0,max:100,default:0,rule:"filter",func:"sepia",unit:"%"}),_VALID_EFFECTS),_target=void 0,_nodes=void 0,_centers=void 0,_params=void 0,_effects=void 0,_pointer={},_lastDeltas=void 0,_frameLoop=void 0,_invRunoff=void 0,constrain=function(e,t,n){return"number"!=typeof e?NaN:(null!=t&&"number"==typeof t&&(e=Math.max(e,t)),null!=n&&"number"==typeof n&&(e=Math.min(e,n)),e)},roundTo=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=Math.pow(t+1,10);return Math.round(e*n)/n},delta=function(e,t,n){return(n-t)*e+t},map=function(e,t,n,r,a){return(e-t)*(a-r)/(n-t)+r},XOR=function(e,t){return(e||t)&&!(e&&t)},isVisibleInViewport=function(e){var t=e.getBoundingClientRect(),n=document.documentElement;return 0<=t.right&&t.left<=n.clientWidth&&0<=t.bottom&&t.top<=n.clientHeight},MouseFader=function(e){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e?(n.preventCenterCalculations=!0,n.target=e,_params=t,n.threshold=_params.hasOwnProperty("threshold")?_params.threshold:0,n.runoff=_params.hasOwnProperty("runoff")?_params.runoff:DEFAULT_RUNOFF,n.attack=_params.hasOwnProperty("attack")?_params.attack:1,n.decay=_params.hasOwnProperty("decay")?_params.decay:1,n.accuracy=_params.hasOwnProperty("accuracy")?_params.accuracy:DEFAULT_ACCURACY,n.invert=_params.invert||!1,n.offsetX=_params.offsetX||0,n.offsetY=_params.offsetY||0,n.jitter=_params.jitter||0,n.direction=_params.direction||DEFAULT_DIRECTION,n.FPS=_params.FPS||DEFAULT_FPS,n.mode=_params.mode||DEFAULT_MODE,n.preventCenterCalculations=!1,n.setCenterPoints(),n.update=n.update.bind(n),n.init(),n):(console.log("MouseFader: target argument is required"),_possibleConstructorReturn(n,null))}return _inherits(r,_extendableBuiltin(EventTarget)),_createClass(r,[{key:"addEffect",value:function(e,t,n){var r=void 0;if(0<(arguments.length<=3?0:arguments.length-3))r={rule:arguments.length<=3?void 0:arguments[3],func:arguments.length<=4?void 0:arguments[4],unit:arguments.length<=5?void 0:arguments[5]};else{if(!VALID_EFFECTS.hasOwnProperty(e))return void console.log(e+" is not a supported effect type");r=VALID_EFFECTS[e]}(_effects=_effects||[]).push({type:e,near:constrain(t,r.min,r.max),far:null!=n?constrain(n,r.min,r.max):t,rule:r.rule,func:r.func,unit:r.unit})}},{key:"hasEffect",value:function(e){}},{key:"effect",value:function(e){}},{key:"removeEffect",value:function(e){}},{key:"init",value:function(){document.addEventListener("mousemove",this.updatePointer),document.dispatchEvent(new MouseEvent("mousemove")),window.addEventListener("scroll",this.windowEvent.bind(this)),window.addEventListener("resize",this.windowEvent.bind(this)),window.requestAnimationFrame(this.update)}},{key:"setCenterPoints",value:function(){_centers=[];for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e],n=t.getBoundingClientRect(),r=.5*(n.left+n.right)-this.offsetX-(t.dataset.jitterx||0),a=.5*(n.top+n.bottom)-this.offsetY-(t.dataset.jittery||0);0<this.jitter&&(r+=(Math.random()-.5)*this.jitter,a+=(Math.random()-.5)*this.jitter),_centers.push({x:r,y:a})}}},{key:"distanceFrom",value:function(e){return this.nodes[e].dataset.distance}},{key:"updatePointer",value:function(e){_pointer.x=e.clientX,_pointer.y=e.clientY}},{key:"windowEvent",value:function(e){var t=this;this.preventCenterCalculations||window.setTimeout(function(){return t.setCenterPoints()},1)}},{key:"update",value:function(e){document.documentElement;for(var t=0;t<this.nodes.length;t++){var n=this.nodes[t],r=_lastDeltas[t],a=(n.getBoundingClientRect(),_centers[t].x-(n.dataset.offsetx||0)),o=_centers[t].y-(n.dataset.offsety||0),i=_pointer.x-a,s=_pointer.y-o,u=void 0,f=void 0,c=void 0;if(u="both"===this.direction?Math.sqrt(i*i+s*s):Math.abs("horizontal"===this.direction?i:s),f=constrain((u-this.threshold)*_invRunoff,0,1),this.invert&&(f=1-f),c=r?r+(f-r)*(XOR(r<f,this.invert)?this.decay:this.attack):f,n.dataset.distance=c,(c=roundTo(c,this.accuracy))<=1&&_effects){for(var l={},d=0;d<_effects.length;d++){var p=_effects[d],_=(p.type,p.near),h=p.far,m=p.rule,y=p.func,v=p.unit||"",g=delta(c,_,h);y?(l[m]||(l[m]=[]),l[m].push(y+"("+g+v+")")):n.style[m]=""+g+v}for(var E in l)n.style[E]=l[E].join(" ");n.style.zIndex=1e3-Math.floor(1e3*c)}_lastDeltas[t]=c}"redraw"===this.mode&&window.requestAnimationFrame(this.update),this.dispatchEvent(new Event("redraw"))}},{key:"target",get:function(){return _target},set:function(e){var t=void 0;if(e instanceof HTMLElement){if(console.log("HTMLElement with "+e.children.length+" children found"),e.children.length<1){var n=document.createElement("span");e.parentNode.insertBefore(n,e),n.appendChild(e),e=n}t=e.children}else{if(!(e instanceof NodeList))return void console.log(e+" is not a suitable target");console.log("NodeList with "+e.length+" childNodes found"),t=e}t.length<1?console.log("No children found on "+e):(this.nodes=t,_params&&!this.preventCenterCalculations&&this.setCenterPoints(),_lastDeltas=new Array(this.nodes.length))}},{key:"threshold",get:function(){return _params.threshold},set:function(e){_params.threshold=constrain(e,0)}},{key:"runoff",get:function(){return _params.runoff},set:function(e){_params.runoff=constrain(e,0),_invRunoff=1/_params.runoff}},{key:"boundary",get:function(){return this.threshold+this.runoff}},{key:"invert",get:function(){return _params.invert},set:function(e){_params.invert=!!e}},{key:"attack",get:function(){return _params.attack},set:function(e){_params.attack=constrain(e,0,1)}},{key:"decay",get:function(){return _params.decay},set:function(e){_params.decay=constrain(e,0,1)}},{key:"offsetX",get:function(){return _params.offsetX},set:function(e){_params.offsetX=e,this.preventCenterCalculations||this.setCenterPoints()}},{key:"offsetY",get:function(){return _params.offsetY},set:function(e){_params.offsetY=e,this.preventCenterCalculations||this.setCenterPoints()}},{key:"jitter",get:function(){return _params.jitter},set:function(e){_params.jitter=constrain(e,0),this.preventCenterCalculations||this.setCenterPoints()}},{key:"direction",get:function(){return _params.direction},set:function(e){VALID_DIRECTIONS.has(e)?_params.direction=e:console.log(e+" not a valid direction.")}},{key:"FPS",get:function(){return _params.FPS},set:function(e){0<e?_params.FPS=constrain(e,0):console.log("Invalid FPS requested")}},{key:"mode",get:function(){return _params.mode},set:function(e){e!==_params.mode?VALID_MODES.has(e)?_params.mode=e:console.log(e+" not a recognised mode."):console.log("Already in "+e+" mode. Mode not changed.")}},{key:"accuracy",get:function(){return _params.accuracy},set:function(e){_params.accuracy=Math.floor(constrain(e,0))}}]),r}();